<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>5MP Motion Camera: How to Build a Waterproof, Battery-Operated, Low-Power, Motion-Activated, 5 Mega-pixel WiFi Camera</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">5MP Motion Camera
   &#160;<span id="projectnumber">1.1.1.1</span>
   </div>
   <div id="projectbrief">A waterproof, low power, battery operated, motion activated, 5 mega-pixel, WiFi camera.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">How to Build a Waterproof, Battery-Operated, Low-Power, Motion-Activated, 5 Mega-pixel WiFi Camera </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This project shows you how to build a WiFi camera that sleeps until activated by a microwave motion sensor. It carefully conserves power to maximize battery life. (You can expect to get a full week of use from the battery.) The camera takes great color pictures and movies in a range of sizes from 320x240px up to 2592x1944px. The camera's <a href="https://www.adafruit.com/product/3010">Adafruit Feather M0</a> sends the pictures to a <a href="https://en.wikipedia.org/wiki/Common_Gateway_Interface">CGI</a> for image processing and storage. (See the <a href="https://github.com/patrickmoffitt/jpeg_catcher">JPEG Catcher project for further details</a>.) There is no SD card in this project. The images are stored "in-your-cloud" where the CGI is hosted. This project teaches you how to move relatively large hunks of data like the camera's 8MB image buffer in small hunks like the WINC1500's 1400 byte <a href="https://en.wikipedia.org/wiki/Maximum_transmission_unit">MTU</a> over WiFi to a server. It does this using the old-school method of <a href="https://en.wikipedia.org/wiki/Base64">base64 encoding</a> the binary image data. This makes the data into a stream of visible characters that get piped into the CGI on standard input. The CGI decodes the data back into binary format and saves it to storage. From there a web server makes the images browsable. The camera has a wide assortment of settings that control all aspects of picture taking. The <a href="https://github.com/patrickmoffitt/camera_settings">Camera Settings Project</a> provides a mobile-responsive web page for adjusting those settings. This means you won't have to compile a new binary and load it into the Feather just to adjust the camera's exposure, brightness, or contrast, et cetera. The settings are passed from the web page to a web socket server in the form of <a href="https://google.github.io/flatbuffers/index.html">Google flatBuffers</a>. This is the new-school way to move relatively-small, fixed length, data structures around the web <em>in binary format</em>. The flatBuffers project provides libraries in many languages so that it's easy to go from JavaScript to C++ and back. This project includes both old and new school data communication methods for several reasons;</p><ul>
<li>There is still a whole lot of legacy code in use and you might one day be happy to take a job maintaining it so wouldn't it be nice if you new how it worked?</li>
<li>The old school way built the Internet and eMail as we know it and really good old-ideas often come around again in new forms. So while the implementation is old, the concepts used are still relevant to today's engineering problems.</li>
<li>The Internet of Things needs very efficient, low-power, machine-to-machine communication and projects like flatBuffers are a good solution. The need is so ubiquitous it's essential that everyone in the robotics/embedded space is familiar with such solutions.</li>
</ul>
<h2>Schematic </h2>
<div class="image">
<img src="5MP_Motion_Camera_v1_2.jpg" alt="5MP_Motion_Camera_v1_2.jpg"/>
<div class="caption">
Eechema Schematic</div></div>
<ul>
<li><a href="images/5MP_Motion_Camera_v1_2.pdf">Eechema Schematic PDF</a></li>
<li><a href="images/5MP_Motion_Camera_v1_2.sch">Eechema Schematic</a></li>
</ul>
<h2>Building </h2>
<p>I used <a href="https://platformio.org/">platformio</a> to build this project. If you plan to do the same you'll need to create a platformio.ini file. It should look something like the one below. Replace the items in all-caps with your own configuration. </p><div class="fragment"><div class="line">[common]</div><div class="line">lib_deps_external =</div><div class="line">    https://github.com/arduino-libraries/WiFi101.git</div><div class="line"></div><div class="line">[env:adafruit_feather_m0]</div><div class="line">platform = atmelsam</div><div class="line">board= adafruit_feather_m0</div><div class="line">framework = arduino</div><div class="line">upload_port = /dev/YOUR_TTY_DEVICE</div><div class="line">upload_speed = 115200</div><div class="line">lib_deps = ${common.lib_deps_external}</div><div class="line">build_flags =</div><div class="line">    &#39;-DWIFI_SSID=&quot;YOUR WIFI ACCESS POINT SSID&quot;&#39;</div><div class="line">    &#39;-DWIFI_PASS=&quot;YOUR WIFI PASSWORD&quot;&#39;</div><div class="line">    &#39;-DHTTP_HOST=&quot;IP ADDRESS OF YOUR CGI/WEBSOCKET SERVER&quot;&#39;</div><div class="line">    &#39;-DHTTP_HOST_PORT=4444&#39;</div><div class="line">    &#39;-DSOCKET_PORT=8880&#39;</div><div class="line">    &#39;-DHTTP_HOST_URL=&quot;/cgi-bin/jpeg_catcher&quot;&#39;</div><div class="line">    &#39;-std=c++14&#39;</div><div class="line">    &#39;-std=gnu++14&#39;</div><div class="line">build_unflags =</div><div class="line">    &#39;-std=gnu++11&#39;</div></div><!-- fragment --><h2>Credits </h2>
<ul>
<li>Thank you to <a href="https://github.com/wblommaert">wblommaert</a> for his Arduino Websocket Client.</li>
<li>Thank you to <a href="https://www.martystepp.com/">Marty Stepp</a> for his base 64 encoding and decoding library.</li>
<li>Thank you to the <a href="https://github.com/google/flatbuffers/graphs/contributors">FlatBuffers contributors</a> for the <a href="https://github.com/google/flatbuffers">Google FlatBuffers</a> project.</li>
</ul>
<h2>Bugs, Issues, and Pull Requests </h2>
<p>If you find a bug please create an issue. If you'd like to contribute please send a pull request.</p>
<h2>References </h2>
<p>The following were helpful references in the development of this project.</p><ul>
<li><a class="el" href="class_ardu_c_a_m.html">ArduCAM</a><ul>
<li><a href="https://www.arducam.com/docs/spi-cameras-for-arduino/hardware/arducam-shield-mini-5mp-plus/">Arducam Shield Mini 5MP Plus</a></li>
<li><a href="https://www.arducam.com/docs/spi-cameras-for-arduino/hardware/arducam-chip/">Arducam Chip - Technical Specifications</a></li>
<li><a href="https://github.com/ArduCAM/Arduino/tree/6b65ff4f6259374558b76005c0fbc8c3a0681aef/ArduCAM/examples/mini">ArduCAM Mini 5MP OV5640 Plus Examples</a></li>
</ul>
</li>
<li>WebSockets<ul>
<li><a href="https://noio-ws.readthedocs.io/en/latest/overview_of_websockets.html">A brief overview of the websocket protocol</a></li>
<li><a href="https://github.com/wblommaert/arduino-websocket-client">Arduino Websocket Client</a></li>
</ul>
</li>
<li>RCWL-0516 Microwave Motion Sensor<ul>
<li><a href="https://github.com/jdesbonnet/RCWL-0516">RCWL-0516 microwave motion sensor</a> </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
